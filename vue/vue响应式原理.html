<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue响应式原理 | just2011lin的技术博客</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="学了什么就用什么">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.f507fe5c.js" as="script"><link rel="preload" href="/assets/js/2.329362c0.js" as="script"><link rel="preload" href="/assets/js/35.60520fb6.js" as="script"><link rel="prefetch" href="/assets/js/10.50184b14.js"><link rel="prefetch" href="/assets/js/11.40639c88.js"><link rel="prefetch" href="/assets/js/12.2b633aa8.js"><link rel="prefetch" href="/assets/js/13.c2cb6e7d.js"><link rel="prefetch" href="/assets/js/14.77eee6c1.js"><link rel="prefetch" href="/assets/js/15.0071b438.js"><link rel="prefetch" href="/assets/js/16.a5e93048.js"><link rel="prefetch" href="/assets/js/17.be2f72ef.js"><link rel="prefetch" href="/assets/js/18.d1dfdffe.js"><link rel="prefetch" href="/assets/js/19.c63dedd4.js"><link rel="prefetch" href="/assets/js/20.fb9d0759.js"><link rel="prefetch" href="/assets/js/21.bb8e85e8.js"><link rel="prefetch" href="/assets/js/22.baa36040.js"><link rel="prefetch" href="/assets/js/23.ced46d0c.js"><link rel="prefetch" href="/assets/js/24.0612341a.js"><link rel="prefetch" href="/assets/js/25.2c5250e5.js"><link rel="prefetch" href="/assets/js/26.3e56ba12.js"><link rel="prefetch" href="/assets/js/27.33f225ba.js"><link rel="prefetch" href="/assets/js/28.b75fb278.js"><link rel="prefetch" href="/assets/js/29.06ce868f.js"><link rel="prefetch" href="/assets/js/3.6e902163.js"><link rel="prefetch" href="/assets/js/30.5713142b.js"><link rel="prefetch" href="/assets/js/31.c36c8bfe.js"><link rel="prefetch" href="/assets/js/32.a4cc06c8.js"><link rel="prefetch" href="/assets/js/33.a5471b6d.js"><link rel="prefetch" href="/assets/js/34.a9b789f3.js"><link rel="prefetch" href="/assets/js/36.fc23a3b6.js"><link rel="prefetch" href="/assets/js/37.a6798c92.js"><link rel="prefetch" href="/assets/js/38.4baf6962.js"><link rel="prefetch" href="/assets/js/39.0379d964.js"><link rel="prefetch" href="/assets/js/4.ba3164ba.js"><link rel="prefetch" href="/assets/js/40.78be8984.js"><link rel="prefetch" href="/assets/js/5.75a3592b.js"><link rel="prefetch" href="/assets/js/6.0377ba0c.js"><link rel="prefetch" href="/assets/js/7.abf41f48.js"><link rel="prefetch" href="/assets/js/8.72a7f551.js"><link rel="prefetch" href="/assets/js/9.0cf5eb4e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">just2011lin的技术博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="浏览" class="dropdown-title"><span class="title">浏览</span> <span class="arrow down"></span></button> <button type="button" aria-label="浏览" class="mobile-dropdown-title"><span class="title">浏览</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javascript/" class="nav-link">
  javascript
</a></li><li class="dropdown-item"><!----> <a href="/react/" class="nav-link">
  react
</a></li><li class="dropdown-item"><!----> <a href="/stylesheet/" class="nav-link">
  stylesheet
</a></li><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link router-link-active">
  vue
</a></li><li class="dropdown-item"><!----> <a href="/third-party/" class="nav-link">
  third-party
</a></li><li class="dropdown-item"><!----> <a href="/other/" class="nav-link">
  other
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="浏览" class="dropdown-title"><span class="title">浏览</span> <span class="arrow down"></span></button> <button type="button" aria-label="浏览" class="mobile-dropdown-title"><span class="title">浏览</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/javascript/" class="nav-link">
  javascript
</a></li><li class="dropdown-item"><!----> <a href="/react/" class="nav-link">
  react
</a></li><li class="dropdown-item"><!----> <a href="/stylesheet/" class="nav-link">
  stylesheet
</a></li><li class="dropdown-item"><!----> <a href="/vue/" class="nav-link router-link-active">
  vue
</a></li><li class="dropdown-item"><!----> <a href="/third-party/" class="nav-link">
  third-party
</a></li><li class="dropdown-item"><!----> <a href="/other/" class="nav-link">
  other
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Vue响应式原理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue/vue%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.html#definereactive函数" class="sidebar-link">defineReactive函数</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vue/vue%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.html#observer类" class="sidebar-link">Observer类</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vue/vue%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.html#observe方法" class="sidebar-link">observe方法</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vue/vue%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.html#递归调用侦测对象" class="sidebar-link">递归调用侦测对象</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vue/vue%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.html#数组七个方法的响应式" class="sidebar-link">数组七个方法的响应式</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vue/vue%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.html#dep类" class="sidebar-link">Dep类</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vue/vue%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.html#watch类" class="sidebar-link">Watch类</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vue/vue%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.html#parsepath方法" class="sidebar-link">parsePath方法</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vue/vue%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.html#讲解响应式的步骤" class="sidebar-link">讲解响应式的步骤</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue/vue%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.html#第一步-定义definereactive方法" class="sidebar-link">第一步：定义defineReactive方法</a></li><li class="sidebar-sub-header"><a href="/vue/vue%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.html#第二步-定义observer类与observe方法-并调用observe方法去监听obj上的所有属性" class="sidebar-link">第二步：定义Observer类与observe方法，并调用observe方法去监听obj上的所有属性</a></li><li class="sidebar-sub-header"><a href="/vue/vue%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.html#第三步-递归监听obj上属性值的属性等、对设置的新属性值进行监听" class="sidebar-link">第三步：递归监听obj上属性值的属性等、对设置的新属性值进行监听</a></li><li class="sidebar-sub-header"><a href="/vue/vue%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.html#第四步-对数组的七个方法进行监听" class="sidebar-link">第四步：对数组的七个方法进行监听</a></li><li class="sidebar-sub-header"><a href="/vue/vue%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.html#第五步-对数组方法中新插入的项进行监听" class="sidebar-link">第五步：对数组方法中新插入的项进行监听</a></li><li class="sidebar-sub-header"><a href="/vue/vue%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86.html#第六步-建立依赖收集与监听" class="sidebar-link">第六步：建立依赖收集与监听</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue响应式原理"><a href="#vue响应式原理" class="header-anchor">#</a> Vue响应式原理</h1> <p>综述：</p> <p>1.Vue首先要将数据变为可侦听变化的形式</p> <p>2.其次再用监听器去监听数据属性的变化</p> <h2 id="definereactive函数"><a href="#definereactive函数" class="header-anchor">#</a> defineReactive函数</h2> <p>1.定义一个方法，参数为obj,key,value，其中value可选，默认为target[key]</p> <p>2.内部使用Object.definePrototype将obj的key属性变为getter与setter形式</p> <p>3.将value变量作为getter的值返回、并在setter中将新值赋值给value</p> <p>4.检验target必须为引用类型值且不能为null</p> <h2 id="observer类"><a href="#observer类" class="header-anchor">#</a> Observer类</h2> <p>1.定义Observer类</p> <p>2.定义静态方法setObserver，参数为obj，此方法将设置obj的不可枚举__ob__属性，值为新创建的Observer实例并返回该实例</p> <p>3.定义构造函数并接收参数obj，并调用walk方法</p> <p>4.定义walk方法，对obj自身的每个属性使用defineReactive方法</p> <p>5.定义Observer的静态方法getObserver，参数为obj，返回obj的__ob__属性值</p> <h2 id="observe方法"><a href="#observe方法" class="header-anchor">#</a> observe方法</h2> <p>1.定义observe方法并接收一个obj对象</p> <p>2.验证obj为引用类型</p> <p>3.检验obj是否有__ob__属性值，若没有则创建__ob__属性值，最后返回obj的__ob__属性值</p> <h2 id="递归调用侦测对象"><a href="#递归调用侦测对象" class="header-anchor">#</a> 递归调用侦测对象</h2> <p>1.在defineReactive函数内对value使用observe方法</p> <p>2.在defineReactive中的setter中对设置的新值调用observe方法</p> <h2 id="数组七个方法的响应式"><a href="#数组七个方法的响应式" class="header-anchor">#</a> 数组七个方法的响应式</h2> <p>1.使用Object.create方法并传入Array.prototype创建arrayMethods对象</p> <p>2.定义一个数组，存放数组上修改数组内容的七个方法的名称（push pop shift unshift splice sort reverse）</p> <p>3.修改arrayMethods上的这七个方法，方法内调用数组原方法并返回结果</p> <p>4.对于push、unshift与splice方法新加入的值使用observer方法</p> <p>5.在Observer类的构造函数内，若obj为数组，则用Object.setPrototype方法将其原型设置为arrayMethods</p> <h2 id="dep类"><a href="#dep类" class="header-anchor">#</a> Dep类</h2> <p>1.定义Dep和Watch类</p> <p>2.在Observer构造函数内定义属性dep，值为Dep实例</p> <p>3.在defineReactive方法内创建实例dep并在setter中调用notify方法，setter中的notify方法要在对value赋值后调用</p> <p>4.定义Dep实例的notify方法</p> <p>5.数组定义的七个方法内调用ob.dep.notify()</p> <p>6.定义属性subs用于存放Watch实例</p> <p>7.定义方法depend用于在依赖收集阶段收集Watch实例</p> <p>8.在defineReactive内的getter中调用depend方法</p> <p>9.在defineReactive内有两个dep要处理，一个是与属性绑定的dep，另一个是与对象绑定的dep？</p> <h2 id="watch类"><a href="#watch类" class="header-anchor">#</a> Watch类</h2> <p>1.定义update方法并在Dep类的notify方法中使用收集的watch的update方法</p> <p>2.定义构造函数，并设定参数target、expression和callback</p> <p>3.构造函数内，定义属性target值为参数target</p> <p>4.构造函数内，定义属性getter值为解析expression后用于获取值的方法</p> <p>5.构造函数内，定义属性callback值为callback参数</p> <p>6.构造函数内，定义属性value值为调用实例方法get的返回值</p> <p>7.定义get函数，在内部设置Dep.target为this，并且用getter+target获取value，最后将Dep.target设置为null并返回value</p> <p>8.定义update方法，内部调用run方法</p> <p>9.定义run方法，并在内部调用getAndInvoke方法，并传入callback属性值</p> <p>10.定义getAndInvoke方法以及参数callback，内部使用get方法获取新值，若新值与已有的value属性值不相等或新值为一个数组，用变量缓存this.value作为旧值并将this.value设置为新值，
然后调用callback函数的call方法，并以此传入this.target以及新值和旧值</p> <h2 id="parsepath方法"><a href="#parsepath方法" class="header-anchor">#</a> parsePath方法</h2> <h2 id="讲解响应式的步骤"><a href="#讲解响应式的步骤" class="header-anchor">#</a> 讲解响应式的步骤</h2> <h3 id="第一步-定义definereactive方法"><a href="#第一步-定义definereactive方法" class="header-anchor">#</a> 第一步：定义defineReactive方法</h3> <p>1.提出defineReactive方法与三个参数obj key value</p> <p>2.随后定义isReference函数用于判断值是否为引用类型</p> <p>3.判断defineReactive的参数obj是否为引用类型，不是则不继续处理</p> <p>4.判断defineReactive的参数个数，为2个则将value赋值为obj[key]</p> <p>5.使用Object.defineProperty方法并写enumerable, configurable, get, set</p> <p>6.验证：定义有一个属性的对象，并验证defineReactive方法</p> <h3 id="第二步-定义observer类与observe方法-并调用observe方法去监听obj上的所有属性"><a href="#第二步-定义observer类与observe方法-并调用observe方法去监听obj上的所有属性" class="header-anchor">#</a> 第二步：定义Observer类与observe方法，并调用observe方法去监听obj上的所有属性</h3> <p>1.提出Observer类与observe方法</p> <p>2.在Observer的构造函数内将this赋值为obj的__obj__属性，并对obj调用walk方法</p> <p>3.定义walk方法，并对obj的所有属性调用defineReactive方法</p> <p>4.定义observe方法，参数obj不为引用类型时不处理，获取__ob__属性值，未获取到，则调用new Observer(ojb)并返回observer实例</p> <p>5.验证：定义有两个属性的对象，并使用observe方法监听这个对象</p> <h3 id="第三步-递归监听obj上属性值的属性等、对设置的新属性值进行监听"><a href="#第三步-递归监听obj上属性值的属性等、对设置的新属性值进行监听" class="header-anchor">#</a> 第三步：递归监听obj上属性值的属性等、对设置的新属性值进行监听</h3> <p>1.在defineReactive内在defineProperty之前对value调用observe方法</p> <p>2.在defineReactive内的setter中对新设置的值进行监听</p> <h3 id="第四步-对数组的七个方法进行监听"><a href="#第四步-对数组的七个方法进行监听" class="header-anchor">#</a> 第四步：对数组的七个方法进行监听</h3> <p>1.以数组原型为参数调用Object.create方法来创建arrayMethods对象</p> <p>2.定义数组七个方法名组成的字符串数组</p> <p>3.遍历七个方法名，使用defineProperty重定义arrayMethods上的这七个方法</p> <p>4.在重定义的方法内使用原方法并传入this与参数，最后返回原方法放回值</p> <p>5.在Observer构造函数内，判断obj是否为数组，若为数组则将其原型链改为arrayMethods</p> <p>5.验证：定义有数组属性的对象，并调用这七个方法，验证返回值与监听效果</p> <h3 id="第五步-对数组方法中新插入的项进行监听"><a href="#第五步-对数组方法中新插入的项进行监听" class="header-anchor">#</a> 第五步：对数组方法中新插入的项进行监听</h3> <p>1.对数组内的每一项进行监听</p> <p>2.在重定义的方法内获取插入的项，并对它们依次使用observe方法</p> <p>3.插入项的方法有push unshift splice</p> <h3 id="第六步-建立依赖收集与监听"><a href="#第六步-建立依赖收集与监听" class="header-anchor">#</a> 第六步：建立依赖收集与监听</h3> <p>1.提出Dep与Watch类</p> <p>2.定义Dep类，定义属性subs，静态属性target，方法depend、notify</p> <p>3.定义Watch类，定义构造函数，参数为vm,expression,cb，定义属性vm,cb,getter,value，定义方法get与update</p> <p>4.在Observer构造函数内，设置属性dep为Dep类实例</p> <p>5.在defineReactive方法内，创建与属性绑定的Dep实例，并将监听value的返回值赋值给childOb变量，在getter中对这两个dep调用依赖收集</p> <p>6.在defineReactive方法的setter内，将observe新值的返回值赋值给childOb变量，调用属性绑定的Dep实例的notify方法</p> <p>7.在数组重写的原型方法内，调用this上的observer的dep的notify方法</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f507fe5c.js" defer></script><script src="/assets/js/2.329362c0.js" defer></script><script src="/assets/js/35.60520fb6.js" defer></script>
  </body>
</html>
